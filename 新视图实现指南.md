# æ–°è§†å›¾å®ç°æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•åœ¨è¯¥é¡¹ç›®ä¸­å®ç°ä¸€ä¸ªæ–°çš„è§†å›¾ï¼ˆæ ‡ç­¾é¡µï¼‰ã€‚

## ğŸ“‹ å®ç°æ­¥éª¤æ¦‚è§ˆ

1. **å‰ç«¯ç»„ä»¶** â†’ 2. **æ³¨å†Œåˆ°Dashboard** â†’ 3. **å‰ç«¯API** â†’ 4. **åç«¯æœåŠ¡** â†’ 5. **åç«¯è·¯ç”±** â†’ 6. **æ³¨å†Œè·¯ç”±**

---

## æ­¥éª¤ 1: åˆ›å»ºå‰ç«¯æ ‡ç­¾é¡µç»„ä»¶

åœ¨ `fronted/src/components/tabs/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„ Vue ç»„ä»¶ã€‚

**ç¤ºä¾‹ï¼šåˆ›å»º `NewTab.vue`**

```vue
<template>
  <div class="new-tab">
    <h2>æ–°è§†å›¾æ ‡é¢˜</h2>
    <p class="chart-description">è§†å›¾æè¿°ä¿¡æ¯</p>
    
    <!-- ä½ çš„å›¾è¡¨ç»„ä»¶ -->
    <div class="chart-container">
      <YourChartComponent :data="chartData" />
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import { useFetchData } from '@/utils/fetchData.js'
import { getNewData } from '@/api/newApi.js'
import YourChartComponent from '@/components/charts/YourChartComponent.vue'

// ä½¿ç”¨æ•°æ®è·å–å·¥å…·
const { data: chartData, loading, error, execute } = useFetchData(getNewData)

// ç»„ä»¶æŒ‚è½½æ—¶è‡ªåŠ¨åŠ è½½æ•°æ®
onMounted(async () => {
  try {
    await execute()
  } catch (err) {
    console.error('åŠ è½½æ•°æ®å¤±è´¥:', err)
  }
})
</script>

<style scoped>
.new-tab {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.chart-description {
  color: #666;
  line-height: 1.6;
}

.chart-container {
  min-height: 400px;
}
</style>
```

**å‚è€ƒæ–‡ä»¶ï¼š**
- `fronted/src/components/tabs/Q1Tab.vue` - ç®€å•å¸ƒå±€ç¤ºä¾‹
- `fronted/src/components/tabs/Q3Tab.vue` - å¤æ‚å¸ƒå±€ç¤ºä¾‹ï¼ˆå¤šä¸ªå›¾è¡¨ï¼‰

---

## æ­¥éª¤ 2: æ³¨å†Œåˆ° Dashboard

ç¼–è¾‘ `fronted/src/components/Dashboard.vue`ï¼š

### 2.1 å¯¼å…¥æ–°ç»„ä»¶

```vue
<script setup>
import { ref } from 'vue'
import Q1Tab from './tabs/Q1Tab.vue'
import Q3Tab from './tabs/Q3Tab.vue'
import Q5Tab from './tabs/Q5Tab.vue'
import NewTab from './tabs/NewTab.vue'  // ğŸ‘ˆ æ·»åŠ è¿™è¡Œ

const activeTab = ref('q1')

const tabs = [
  { id: 'q1', label: 'Q1' },
  { id: '3d-chart', label: 'Q3' },
  { id: 'q5', label: 'Q5' },
  { id: 'new', label: 'æ–°è§†å›¾' }  // ğŸ‘ˆ æ·»åŠ è¿™è¡Œ
]
</script>
```

### 2.2 æ·»åŠ æ¨¡æ¿æ¸²æŸ“

```vue
<template>
  <div class="dashboard">
    <!-- ... å…¶ä»–ä»£ç  ... -->
    
    <div class="content">
      <!-- ... å…¶ä»–æ ‡ç­¾é¡µ ... -->
      
      <!-- æ–°è§†å›¾ -->
      <div v-if="activeTab === 'new'" class="tab-content active">
        <NewTab />
      </div>
    </div>
  </div>
</template>
```

**å‚è€ƒæ–‡ä»¶ï¼š**
- `fronted/src/components/Dashboard.vue` - æŸ¥çœ‹å®Œæ•´çš„æ³¨å†Œç¤ºä¾‹

---

## æ­¥éª¤ 3: åˆ›å»ºå‰ç«¯ API å®¢æˆ·ç«¯ï¼ˆå¦‚éœ€è¦ï¼‰

åœ¨ `fronted/src/api/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„ API æ–‡ä»¶ã€‚

**ç¤ºä¾‹ï¼šåˆ›å»º `newApi.js`**

```javascript
import apiClient from './apiClient'

/**
 * è·å–æ–°è§†å›¾æ•°æ®
 * @param {string} param1 - å‚æ•°1è¯´æ˜
 * @param {number} param2 - å‚æ•°2è¯´æ˜
 */
export const getNewData = async (param1, param2) => {
  const response = await apiClient.get('/new/endpoint', {
    params: { param1, param2 }
  })
  return response.data
}

/**
 * è·å–å…¶ä»–æ•°æ®
 */
export const getOtherData = async () => {
  const response = await apiClient.get('/new/other')
  return response.data
}
```

**å‚è€ƒæ–‡ä»¶ï¼š**
- `fronted/src/api/q1Api.js` - ç®€å•çš„ GET è¯·æ±‚ç¤ºä¾‹
- `fronted/src/api/salary3dApi.js` - å¤æ‚è¯·æ±‚ç¤ºä¾‹

---

## æ­¥éª¤ 4: åˆ›å»ºåç«¯æœåŠ¡å±‚ï¼ˆå¦‚éœ€è¦ï¼‰

åœ¨ `services/` ç›®å½•ä¸‹åˆ›å»ºæœåŠ¡æ–‡ä»¶ã€‚

**ç¤ºä¾‹ï¼šåˆ›å»º `new_service.py`**

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
æ–°è§†å›¾æœåŠ¡
"""

import logging
from typing import List, Dict, Any
from database.Q3 import DatabaseManager

logger = logging.getLogger(__name__)


class NewService:
    """æ–°è§†å›¾æœåŠ¡ç±»"""
    
    def __init__(self, db_manager: DatabaseManager):
        self.db_manager = db_manager
    
    def get_data(self, param1: str, param2: int = None) -> Dict[str, Any]:
        """
        è·å–æ•°æ®
        """
        query = """
            SELECT column1, column2, column3
            FROM data
            WHERE condition = %s
            LIMIT %s
        """
        
        results = self.db_manager.execute_query(query, (param1, param2))
        
        # å¤„ç†æ•°æ®
        data_list = []
        for row in results:
            data_list.append({
                "field1": row[0],
                "field2": row[1],
                "field3": row[2]
            })
        
        return {
            "total": len(data_list),
            "data": data_list
        }
```

**å‚è€ƒæ–‡ä»¶ï¼š**
- `services/q1_service.py` - åŸºç¡€æœåŠ¡ç¤ºä¾‹
- `services/salary_3d_service.py` - å¤æ‚æœåŠ¡ç¤ºä¾‹

---

## æ­¥éª¤ 5: åˆ›å»ºåç«¯è·¯ç”±

åœ¨ `routes/` ç›®å½•ä¸‹åˆ›å»ºè·¯ç”±æ–‡ä»¶ã€‚

**ç¤ºä¾‹ï¼šåˆ›å»º `new_routes.py`**

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
æ–°è§†å›¾ç›¸å…³è·¯ç”±
"""

import logging
from flask import Blueprint, request

from services.new_service import NewService
from utils.response import ResponseBuilder
from database.Q3 import DatabaseManager

logger = logging.getLogger(__name__)

# åˆ›å»ºè“å›¾
new_bp = Blueprint('new', __name__, url_prefix='/api/new')

# åˆå§‹åŒ–æœåŠ¡
db_manager = DatabaseManager('default')
new_service = NewService(db_manager)


@new_bp.route('/endpoint', methods=['GET'])
def get_data():
    """è·å–æ•°æ®æ¥å£"""
    try:
        param1 = request.args.get('param1')
        param2 = request.args.get('param2', type=int)
        
        if not param1:
            return ResponseBuilder.bad_request("ç¼ºå°‘å‚æ•°: param1")
        
        data = new_service.get_data(param1, param2)
        
        return ResponseBuilder.success("è·å–æ•°æ®æˆåŠŸ", data)
        
    except Exception as e:
        logger.error(f"è·å–æ•°æ®å¤±è´¥: {e}")
        return ResponseBuilder.internal_error("æœåŠ¡å™¨å†…éƒ¨é”™è¯¯", {
            "type": "INTERNAL_ERROR",
            "details": str(e)
        })
```

**å‚è€ƒæ–‡ä»¶ï¼š**
- `routes/q1_routes.py` - åŸºç¡€è·¯ç”±ç¤ºä¾‹
- `routes/salary_3d_routes.py` - å¤æ‚è·¯ç”±ç¤ºä¾‹

---

## æ­¥éª¤ 6: æ³¨å†Œåç«¯è·¯ç”±

ç¼–è¾‘ `app.py`ï¼Œæ³¨å†Œæ–°çš„è“å›¾ï¼š

```python
from routes.new_routes import new_bp  # ğŸ‘ˆ æ·»åŠ è¿™è¡Œ

def create_app():
    app = Flask(__name__)
    CORS(app)
    
    # æ³¨å†Œè“å›¾
    app.register_blueprint(city_bp)
    app.register_blueprint(industry_bp)
    app.register_blueprint(experience_bp)
    app.register_blueprint(salary_3d_bp)
    app.register_blueprint(q1_bp)
    app.register_blueprint(industry_stats_bp)
    app.register_blueprint(new_bp)  # ğŸ‘ˆ æ·»åŠ è¿™è¡Œ
    
    # ... å…¶ä»–ä»£ç  ...
```

**å‚è€ƒæ–‡ä»¶ï¼š**
- `app.py` - æŸ¥çœ‹å®Œæ•´çš„æ³¨å†Œç¤ºä¾‹

---

## ğŸ“ å®Œæ•´ç¤ºä¾‹ï¼šå®ç°ä¸€ä¸ªç®€å•çš„ç»Ÿè®¡è§†å›¾

å‡è®¾ä½ è¦å®ç°ä¸€ä¸ª"èŒä½ç»Ÿè®¡è§†å›¾"ï¼Œå±•ç¤ºæ‰€æœ‰èŒä½çš„æ•°é‡ç»Ÿè®¡ã€‚

### 1. å‰ç«¯ç»„ä»¶ (`NewTab.vue`)

```vue
<template>
  <div class="stats-tab">
    <h2>èŒä½ç»Ÿè®¡</h2>
    <div v-if="loading">åŠ è½½ä¸­...</div>
    <div v-else-if="error">é”™è¯¯: {{ error }}</div>
    <div v-else>
      <p>æ€»èŒä½æ•°: {{ stats?.total || 0 }}</p>
      <BarChart :data="stats?.data" />
    </div>
  </div>
</template>

<script setup>
import { onMounted } from 'vue'
import { useFetchData } from '@/utils/fetchData.js'
import { getJobStats } from '@/api/statsApi.js'
import BarChart from '@/components/charts/BarChart.vue'

const { data: stats, loading, error, execute } = useFetchData(getJobStats)

onMounted(() => execute())
</script>
```

### 2. å‰ç«¯ API (`statsApi.js`)

```javascript
import apiClient from './apiClient'

export const getJobStats = async () => {
  const response = await apiClient.get('/stats/jobs')
  return response.data
}
```

### 3. åç«¯æœåŠ¡ (`stats_service.py`)

```python
class StatsService:
    def __init__(self, db_manager):
        self.db_manager = db_manager
    
    def get_job_stats(self):
        query = "SELECT job_title, COUNT(*) as count FROM data GROUP BY job_title"
        results = self.db_manager.execute_query(query)
        return {
            "total": len(results),
            "data": [{"job": row[0], "count": row[1]} for row in results]
        }
```

### 4. åç«¯è·¯ç”± (`stats_routes.py`)

```python
stats_bp = Blueprint('stats', __name__, url_prefix='/api/stats')

@stats_bp.route('/jobs', methods=['GET'])
def get_job_stats():
    try:
        data = stats_service.get_job_stats()
        return ResponseBuilder.success("è·å–ç»Ÿè®¡æˆåŠŸ", data)
    except Exception as e:
        return ResponseBuilder.internal_error("æœåŠ¡å™¨é”™è¯¯", {"details": str(e)})
```

### 5. æ³¨å†Œåˆ° `app.py` å’Œ `Dashboard.vue`

æŒ‰ç…§å‰é¢çš„æ­¥éª¤æ³¨å†Œå³å¯ã€‚

---

## ğŸ” æ£€æŸ¥æ¸…å•

å®ç°æ–°è§†å›¾åï¼Œè¯·æ£€æŸ¥ï¼š

- [ ] å‰ç«¯ç»„ä»¶å·²åˆ›å»ºå¹¶å¯¼å…¥åˆ° Dashboard
- [ ] æ ‡ç­¾é¡µå·²æ·»åŠ åˆ° tabs æ•°ç»„
- [ ] å‰ç«¯ API æ–‡ä»¶å·²åˆ›å»ºï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] åç«¯æœåŠ¡å·²åˆ›å»ºï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] åç«¯è·¯ç”±å·²åˆ›å»ºå¹¶æ³¨å†Œåˆ° app.py
- [ ] æ‰€æœ‰å¯¼å…¥è·¯å¾„æ­£ç¡®
- [ ] æ•°æ®æ ¼å¼å‰åç«¯ä¸€è‡´
- [ ] é”™è¯¯å¤„ç†å·²å®ç°

---

## ğŸ’¡ æç¤º

1. **æ•°æ®æ ¼å¼ç»Ÿä¸€**ï¼šç¡®ä¿å‰åç«¯æ•°æ®æ ¼å¼ä¸€è‡´ï¼Œå‚è€ƒç°æœ‰ API çš„å“åº”æ ¼å¼
2. **é”™è¯¯å¤„ç†**ï¼šä½¿ç”¨ `ResponseBuilder` ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼
3. **æ—¥å¿—è®°å½•**ï¼šåœ¨æœåŠ¡å±‚å’Œè·¯ç”±å±‚æ·»åŠ é€‚å½“çš„æ—¥å¿—è®°å½•
4. **ä»£ç å¤ç”¨**ï¼šæŸ¥çœ‹ç°æœ‰ä»£ç ï¼Œå¤ç”¨ç›¸ä¼¼çš„é€»è¾‘
5. **æµ‹è¯•**ï¼šä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·å’Œ Postman æµ‹è¯• API

---

## ğŸ“š ç›¸å…³æ–‡ä»¶å‚è€ƒ

### å‰ç«¯
- `fronted/src/components/tabs/Q1Tab.vue` - ç®€å•è§†å›¾ç¤ºä¾‹
- `fronted/src/components/tabs/Q3Tab.vue` - å¤æ‚è§†å›¾ç¤ºä¾‹
- `fronted/src/components/Dashboard.vue` - æ ‡ç­¾é¡µæ³¨å†Œ
- `fronted/src/api/q1Api.js` - API å®¢æˆ·ç«¯ç¤ºä¾‹
- `fronted/src/utils/fetchData.js` - æ•°æ®è·å–å·¥å…·

### åç«¯
- `routes/q1_routes.py` - è·¯ç”±ç¤ºä¾‹
- `services/q1_service.py` - æœåŠ¡ç¤ºä¾‹
- `app.py` - åº”ç”¨ä¸»æ–‡ä»¶
- `utils/response.py` - å“åº”æ„å»ºå™¨
- `database/Q3.py` - æ•°æ®åº“ç®¡ç†å™¨

---

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒç°æœ‰ä»£ç æˆ–æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£ã€‚


